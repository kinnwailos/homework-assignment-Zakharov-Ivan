---
- name: Deploy Apache web server with system information page
  hosts: webservers
  become: yes
  vars:
    ansible_roles_path: "{{ playbook_dir }}/../roles"

  roles:
    - webserver

  post_tasks:
    - name: Wait for Apache to start
      wait_for:
        host: 127.0.0.1
        port: 80
        timeout: 30

    - name: Verify website availability
      uri:
        url: "http://127.0.0.1"
        status_code: 200
        timeout: 10
      register: website_check
      until: website_check.status == 200
      retries: 10
      delay: 2
      failed_when: website_check.status != 200

    - name: Display verification result
      debug:
        msg: 
          - "✅ Веб-сайт успешно развёрнут!"
          - "Откройте в браузере: http://localhost"
